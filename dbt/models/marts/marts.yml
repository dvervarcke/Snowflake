version: 2

models:
  - name: dim_menu
    description: Menu dimension keyed by menu_id.
    columns:
      - name: menu_id
        tests:
          - not_null
          - unique
      - name: menu_type_id
        tests:
          - relationships:
              to: ref('dim_menu_types')
              field: menu_type_id

  - name: dim_menu_types
    description: Menu type dimension from the raw menu source.
    columns:
      - name: menu_type_id
        tests:
          - not_null
          - unique
      - name: menu_type
        tests:
          - not_null

  - name: dim_truck_brands
    description: Truck brand dimension from the raw menu source.
    columns:
      - name: truck_brand_id
        tests:
          - not_null
          - unique
      - name: truck_brand_name
        tests:
          - not_null

  - name: dim_item_categories
    description: Item category dimension from the raw menu source.
    columns:
      - name: item_category_id
        tests:
          - not_null
          - unique
      - name: item_category
        tests:
          - not_null

  - name: dim_item_subcategories
    description: Item subcategory dimension from the raw menu source.
    columns:
      - name: item_subcategory_id
        tests:
          - not_null
          - unique
      - name: item_category_id
        tests:
          - not_null
          - relationships:
              to: ref('dim_item_categories')
              field: item_category_id
      - name: item_subcategory
        tests:
          - not_null

  - name: fct_menu_items
    description: Incremental item-grain fact mart with menu, brand, and item category references.
    columns:
      - name: menu_item_id
        tests:
          - not_null
          - unique
      - name: menu_id
        tests:
          - relationships:
              to: ref('dim_menu')
              field: menu_id
      - name: menu_type_id
        tests:
          - relationships:
              to: ref('dim_menu_types')
              field: menu_type_id
      - name: truck_brand_id
        tests:
          - not_null
          - relationships:
              to: ref('dim_truck_brands')
              field: truck_brand_id
      - name: item_category_id
        tests:
          - not_null
          - relationships:
              to: ref('dim_item_categories')
              field: item_category_id
      - name: item_subcategory_id
        tests:
          - not_null
          - relationships:
              to: ref('dim_item_subcategories')
              field: item_subcategory_id
      - name: gross_margin_usd
        tests:
          - non_negative
      - name: gross_margin_pct
        tests:
          - range_between:
              min_value: 0
              max_value: 1
              inclusive: true
